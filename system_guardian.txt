# System Protection Guardian
# à¦†à¦ªà¦¨à¦¾à¦° à¦²à§à¦¯à¦¾à¦ªà¦Ÿà¦ªà¦•à§‡ à¦¬à¦¿à¦ªà¦œà§à¦œà¦¨à¦• à¦ªà¦°à¦¿à¦¬à¦°à§à¦¤à¦¨ à¦¥à§‡à¦•à§‡ à¦°à¦•à§à¦·à¦¾ à¦•à¦°à§‡

# Admin à¦¹à¦¿à¦¸à§‡à¦¬à§‡ à¦šà¦¾à¦²à¦¾à¦¤à§‡ à¦¹à¦¬à§‡
if (-NOT ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] "Administrator")) {
    Write-Warning "à¦à¦‡ à¦¸à§à¦•à§à¦°à¦¿à¦ªà§à¦Ÿ Administrator à¦¹à¦¿à¦¸à§‡à¦¬à§‡ à¦šà¦¾à¦²à¦¾à¦¨!"
    Start-Process powershell.exe "-NoProfile -ExecutionPolicy Bypass -File `"$PSCommandPath`"" -Verb RunAs
    exit
}

$Host.UI.RawUI.WindowTitle = "ğŸ›¡ï¸ System Protection Guardian"
Clear-Host

# Color à¦«à¦¾à¦‚à¦¶à¦¨
function Write-ColorOutput($ForegroundColor) {
    $fc = $host.UI.RawUI.ForegroundColor
    $host.UI.RawUI.ForegroundColor = $ForegroundColor
    if ($args) {
        Write-Output $args
    }
    $host.UI.RawUI.ForegroundColor = $fc
}

Write-ColorOutput Green "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
Write-ColorOutput Cyan "          ğŸ›¡ï¸ SYSTEM PROTECTION GUARDIAN ğŸ›¡ï¸"
Write-ColorOutput Green "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
Write-Host ""

# Backup à¦«à§‹à¦²à§à¦¡à¦¾à¦° à¦¤à§ˆà¦°à¦¿
$backupPath = "$env:USERPROFILE\SystemGuardian_Backups"
if (!(Test-Path $backupPath)) {
    New-Item -ItemType Directory -Path $backupPath -Force | Out-Null
}

# System Restore à¦šà¦¾à¦²à§ à¦•à¦°à¦¾
Write-ColorOutput Yellow "[1/5] System Restore à¦¸à¦•à§à¦°à¦¿à¦¯à¦¼ à¦•à¦°à¦¾ à¦¹à¦šà§à¦›à§‡..."
try {
    Enable-ComputerRestore -Drive "C:\" -ErrorAction SilentlyContinue
    Checkpoint-Computer -Description "Guardian Auto Backup - $(Get-Date -Format 'dd-MM-yyyy HH:mm')" -RestorePointType "MODIFY_SETTINGS"
    Write-ColorOutput Green "âœ… System Restore Point à¦¤à§ˆà¦°à¦¿ à¦¹à¦¯à¦¼à§‡à¦›à§‡!"
} catch {
    Write-ColorOutput Red "âš ï¸ System Restore Point à¦¤à§ˆà¦°à¦¿ à¦•à¦°à¦¤à§‡ à¦¸à¦®à¦¸à§à¦¯à¦¾"
}

# Registry Backup
Write-ColorOutput Yellow "`n[2/5] à¦—à§à¦°à§à¦¤à§à¦¬à¦ªà§‚à¦°à§à¦£ Registry backup à¦•à¦°à¦¾ à¦¹à¦šà§à¦›à§‡..."
$registryBackup = "$backupPath\Registry_Backup_$(Get-Date -Format 'ddMMyyyy_HHmm').reg"
$criticalKeys = @(
    "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run",
    "HKLM\SYSTEM\CurrentControlSet\Services",
    "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon"
)

foreach ($key in $criticalKeys) {
    reg export $key "$registryBackup" /y 2>$null
}
Write-ColorOutput Green "âœ… Registry backup à¦¸à¦®à§à¦ªà¦¨à§à¦¨!"

# à¦¬à¦¿à¦ªà¦œà§à¦œà¦¨à¦• à¦•à¦®à¦¾à¦¨à§à¦¡ à¦¤à¦¾à¦²à¦¿à¦•à¦¾
$dangerousCommands = @(
    "Remove-Item.*-Recurse.*C:\\Windows",
    "Remove-Item.*-Recurse.*C:\\Program Files",
    "Remove-Item.*-Recurse.*Registry::",
    "rd.*\/s.*C:\\Windows",
    "del.*\/s.*C:\\Windows",
    "Format-Volume",
    "Clear-Disk",
    "Remove-Partition",
    "reg delete.*\/f",
    "bcdedit.*\/delete",
    "takeown.*\/f.*C:\\Windows",
    "icacls.*C:\\Windows.*\/reset"
)

Write-ColorOutput Yellow "`n[3/5] Protection Monitor à¦¸à§‡à¦Ÿà¦†à¦ª à¦•à¦°à¦¾ à¦¹à¦šà§à¦›à§‡..."

# PowerShell Profile Protection à¦¯à§‹à¦— à¦•à¦°à¦¾
$profilePath = $PROFILE.CurrentUserAllHosts
$profileDir = Split-Path $profilePath -Parent

if (!(Test-Path $profileDir)) {
    New-Item -ItemType Directory -Path $profileDir -Force | Out-Null
}

$protectionCode = @"
# System Protection Guardian - Auto Loaded
`$global:GuardianActive = `$true

function Invoke-SafetyCheck {
    param([string]`$Command)
    
    `$dangerousPatterns = @(
        'Remove-Item.*-Recurse.*C:\\Windows',
        'Remove-Item.*-Recurse.*Registry::',
        'Format-Volume', 'Clear-Disk',
        'reg delete.*\/f', 'rd.*\/s.*C:\\Windows'
    )
    
    foreach (`$pattern in `$dangerousPatterns) {
        if (`$Command -match `$pattern) {
            Write-Host ""
            Write-Host "ğŸ›¡ï¸â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ğŸ›¡ï¸" -ForegroundColor Red
            Write-Host "        â›” à¦¬à¦¿à¦ªà¦œà§à¦œà¦¨à¦• à¦•à¦®à¦¾à¦¨à§à¦¡ à¦¸à¦¨à¦¾à¦•à§à¦¤ à¦¹à¦¯à¦¼à§‡à¦›à§‡! â›”" -ForegroundColor Yellow
            Write-Host "ğŸ›¡ï¸â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ğŸ›¡ï¸" -ForegroundColor Red
            Write-Host ""
            Write-Host "  à¦†à¦ªà¦¨à¦¿ à¦¯à§‡ à¦•à¦®à¦¾à¦¨à§à¦¡à¦Ÿà¦¿ à¦šà¦¾à¦²à¦¾à¦¤à§‡ à¦šà¦¾à¦šà§à¦›à§‡à¦¨ à¦¸à§‡à¦Ÿà¦¿ à¦†à¦ªà¦¨à¦¾à¦°" -ForegroundColor White
            Write-Host "  à¦¸à¦¿à¦¸à§à¦Ÿà§‡à¦®à§‡à¦° à¦®à¦¾à¦°à¦¾à¦¤à§à¦®à¦• à¦•à§à¦·à¦¤à¦¿ à¦•à¦°à¦¤à§‡ à¦ªà¦¾à¦°à§‡!" -ForegroundColor White
            Write-Host ""
            Write-Host "  ğŸ¯ à¦¸à¦¨à¦¾à¦•à§à¦¤à¦•à§ƒà¦¤ à¦•à¦®à¦¾à¦¨à§à¦¡: `$Command" -ForegroundColor Cyan
            Write-Host ""
            Write-Host "  âœ… à¦†à¦ªà¦¨à¦¾à¦•à§‡ à¦¬à¦¿à¦ªà¦¦ à¦¥à§‡à¦•à§‡ à¦¬à¦¾à¦à¦šà¦¾à¦¨à§‹ à¦¹à¦¯à¦¼à§‡à¦›à§‡!" -ForegroundColor Green
            Write-Host "  ğŸ“ Backup Location: `$env:USERPROFILE\SystemGuardian_Backups" -ForegroundColor Yellow
            Write-Host ""
            Write-Host "ğŸ›¡ï¸â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ğŸ›¡ï¸" -ForegroundColor Red
            Write-Host ""
            return `$false
        }
    }
    return `$true
}

# Command History Monitor
`$PSDefaultParameterValues['Out-Default:OutVariable'] = 'LastCommand'
"@

Add-Content -Path $profilePath -Value $protectionCode -Force
Write-ColorOutput Green "âœ… Protection Monitor à¦¸à¦•à§à¦°à¦¿à¦¯à¦¼ à¦¹à¦¯à¦¼à§‡à¦›à§‡!"

# Windows Defender à¦¸à¦•à§à¦°à¦¿à¦¯à¦¼à¦•à¦°à¦£
Write-ColorOutput Yellow "`n[4/5] Windows Defender à¦šà§‡à¦• à¦•à¦°à¦¾ à¦¹à¦šà§à¦›à§‡..."
try {
    Set-MpPreference -DisableRealtimeMonitoring $false -ErrorAction SilentlyContinue
    Write-ColorOutput Green "âœ… Windows Defender à¦¸à¦•à§à¦°à¦¿à¦¯à¦¼!"
} catch {
    Write-ColorOutput Yellow "âš ï¸ Windows Defender à¦®à§à¦¯à¦¾à¦¨à§à¦¯à¦¼à¦¾à¦²à¦¿ à¦šà§‡à¦• à¦•à¦°à§à¦¨"
}

# System File Protection
Write-ColorOutput Yellow "`n[5/5] System Files à¦šà§‡à¦• à¦•à¦°à¦¾ à¦¹à¦šà§à¦›à§‡..."
Write-ColorOutput Cyan "    (à¦à¦Ÿà¦¿ à¦•à¦¿à¦›à§ à¦¸à¦®à¦¯à¦¼ à¦¨à¦¿à¦¤à§‡ à¦ªà¦¾à¦°à§‡...)"

Start-Process -FilePath "sfc" -ArgumentList "/scannow" -NoNewWindow -Wait -RedirectStandardOutput "$backupPath\sfc_log.txt"

Write-Host ""
Write-ColorOutput Green "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
Write-ColorOutput Green "            âœ… PROTECTION SETUP à¦¸à¦®à§à¦ªà¦¨à§à¦¨! âœ…"
Write-ColorOutput Green "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
Write-Host ""
Write-ColorOutput Cyan "ğŸ¯ à¦à¦–à¦¨ à¦¥à§‡à¦•à§‡ à¦¯à¦–à¦¨à¦‡ à¦†à¦ªà¦¨à¦¿ à¦¬à¦¿à¦ªà¦œà§à¦œà¦¨à¦• à¦•à¦®à¦¾à¦¨à§à¦¡ à¦šà¦¾à¦²à¦¾à¦¬à§‡à¦¨:"
Write-Host "   â€¢ à¦¸à§à¦¬à¦¯à¦¼à¦‚à¦•à§à¦°à¦¿à¦¯à¦¼à¦­à¦¾à¦¬à§‡ à¦¬à§à¦²à¦• à¦¹à¦¬à§‡"
Write-Host "   â€¢ à¦†à¦ªà¦¨à¦¾à¦•à§‡ à¦¸à¦¤à¦°à§à¦• à¦•à¦°à¦¾ à¦¹à¦¬à§‡"
Write-Host "   â€¢ à¦¬à¦¿à¦ªà¦¦ à¦¥à§‡à¦•à§‡ à¦°à¦•à§à¦·à¦¾ à¦•à¦°à¦¾ à¦¹à¦¬à§‡"
Write-Host ""
Write-ColorOutput Yellow "ğŸ“ Backup Location: $backupPath"
Write-ColorOutput Yellow "ğŸ“… System Restore Point à¦¤à§ˆà¦°à¦¿ à¦¹à¦¯à¦¼à§‡à¦›à§‡"
Write-Host ""
Write-ColorOutput Green "ğŸ’¡ à¦ªà¦°à¦¾à¦®à¦°à§à¦¶: à¦¨à¦¤à§à¦¨ PowerShell à¦‰à¦‡à¦¨à§à¦¡à§‹ à¦–à§à¦²à§à¦¨ Protection à¦¸à¦•à§à¦°à¦¿à¦¯à¦¼ à¦•à¦°à¦¤à§‡!"
Write-Host ""

# Test à¦¬à¦¿à¦ªà¦œà§à¦œà¦¨à¦• à¦•à¦®à¦¾à¦¨à§à¦¡ (à¦¶à§à¦§à§ à¦ªà§à¦°à¦¦à¦°à§à¦¶à¦¨)
Write-ColorOutput Cyan "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
Write-ColorOutput Cyan "           ğŸ§ª PROTECTION TEST"
Write-ColorOutput Cyan "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
Write-Host ""
Write-ColorOutput Yellow "à¦à¦‡ à¦•à¦®à¦¾à¦¨à§à¦¡à¦—à§à¦²à§‹ à¦à¦–à¦¨ à¦¥à§‡à¦•à§‡ à¦¬à§à¦²à¦• à¦¹à¦¬à§‡:"
Write-Host "  âŒ Remove-Item C:\Windows -Recurse"
Write-Host "  âŒ reg delete HKLM\SOFTWARE /f"
Write-Host "  âŒ Format-Volume -DriveLetter C"
Write-Host "  âŒ rd /s C:\Windows"
Write-Host ""

Write-ColorOutput Green "à¦ªà¦°à¦¬à¦°à§à¦¤à§€ PowerShell à¦¸à§‡à¦¶à¦¨ à¦¥à§‡à¦•à§‡ Protection à¦¸à¦•à§à¦°à¦¿à¦¯à¦¼ à¦¥à¦¾à¦•à¦¬à§‡!"
Write-Host ""
Write-Host "Press any key to exit..."
$null = $Host.UI.RawUI.ReadKey("NoEcho,IncludeKeyDown")
